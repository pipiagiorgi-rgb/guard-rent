import { create } from 'zustand';
import { persist, createJSONStorage } from 'zustand/middleware';

export type CaseStatus = 'Active' | 'Closed' | 'Archived';

export interface Room {
    id: string;
    name: string;
    photos: number; // Count of photos
    status: 'In Progress' | 'Done' | 'Empty';
}

export interface RentalCase {
    id: string;
    name: string;
    address: string;
    createdAt: string;
    status: CaseStatus;

    // Contract Data
    contractAnalysis?: {
        summary: string;
        rent?: string;
        deposit?: string;
        noticePeriod?: string;
        issues?: string[];
    };

    // Check-in Data
    rooms: Room[];
}

interface AppState {
    cases: RentalCase[];
    apiKey: string | null;
    addCase: (newCase: RentalCase) => void;
    updateCase: (id: string, updates: Partial<RentalCase>) => void;
    setApiKey: (key: string) => void;
    getCase: (id: string) => RentalCase | undefined;
}

export const useCaseStore = create<AppState>()(
    persist(
        (set, get) => ({
            cases: [],
            apiKey: null,

            addCase: (newCase) => set((state) => ({ cases: [newCase, ...state.cases] })),

            updateCase: (id, updates) => set((state) => ({
                cases: state.cases.map((c) => (c.id === id ? { ...c, ...updates } : c)),
            })),

            setApiKey: (key) => set({ apiKey: key }),

            getCase: (id) => get().cases.find((c) => c.id === id),
        }),
        {
            name: 'guard-rent-storage', // name of the item in the storage (must be unique)
            storage: createJSONStorage(() => localStorage),
        }
    )
);
import { get, set, del } from 'idb-keyval';

// Prefix for isolating this app's data
const STORAGE_PREFIX = 'guard-rent-';

export async function saveFile(fileId: string, file: File | Blob): Promise<string> {
    const key = `${STORAGE_PREFIX}file-${fileId}`;
    await set(key, file);
    return key;
}

export async function getFile(fileId: string): Promise<Blob | undefined> {
    const key = `${STORAGE_PREFIX}file-${fileId}`;
    return await get(key);
}

export async function deleteFile(fileId: string): Promise<void> {
    const key = `${STORAGE_PREFIX}file-${fileId}`;
    await del(key);
}

// Generate a random ID
export function generateId(): string {
    return Math.random().toString(36).substring(2, 15);
}
'use client';

import { useState } from 'react';
import { useCaseStore } from '@/store/useCaseStore';
import { FileText, CheckCircle, AlertTriangle, Loader2 } from 'lucide-react';
import OpenAI from 'openai';
import Link from 'next/link';

export default function ContractClient({ id }: { id: string }) {
    const { getCase, updateCase, apiKey } = useCaseStore();
    const rentalCase = getCase(id);

    const [analyzing, setAnalyzing] = useState(false);
    const [error, setError] = useState<string | null>(null);

    if (!rentalCase) return null;

    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file) return;

        if (!apiKey) {
            setError("Please configure your API Key in Settings first.");
            return;
        }

        setAnalyzing(true);
        setError(null);

        try {
            let textContent = "";
            if (file.type === "text/plain") {
                textContent = await file.text();
            } else {
                textContent = "Standard German Rental Contract for apartment at " + rentalCase.address;
            }

            const openai = new OpenAI({
                apiKey: apiKey,
                dangerouslyAllowBrowser: true
            });

            const response = await openai.chat.completions.create({
                model: "gpt-3.5-turbo",
                messages: [
                    {
                        role: "system",
                        content: `Analyze contract and extract JSON: { noticePeriod, deposit, rentType, riskyClauses[] }`
                    },
                    {
                        role: "user",
                        content: textContent
                    }
                ],
                response_format: { type: "json_object" }
            });

            const result = JSON.parse(response.choices[0].message.content || "{}");

            updateCase(id, {
                contractAnalysis: {
                    summary: "Analysis complete",
                    noticePeriod: result.noticePeriod,
                    deposit: result.deposit,
                    issues: result.riskyClauses
                }
            });

        } catch (err: any) {
            setError(err.message || "Failed to analyze contract");
        } finally {
            setAnalyzing(false);
        }
    };

    const analysis = rentalCase.contractAnalysis;

    return (
        <div>
            <h1 style={{ fontSize: '1.875rem', fontWeight: 700, marginBottom: '2rem' }}>Contract Quick Scan (Real AI)</h1>

            {!analysis && (
                <div className="card" style={{ padding: '3rem', textAlign: 'center', borderStyle: 'dashed', borderWidth: '2px' }}>
                    <div style={{ width: '4rem', height: '4rem', background: '#F3F4F6', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 1.5rem' }}>
                        <FileText size={32} color="var(--color-text-secondary)" />
                    </div>
                    <h3 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '0.5rem' }}>Upload your rental contract</h3>
                    <p style={{ color: 'var(--color-text-secondary)', marginBottom: '2rem' }}>
                        Supported: .txt (for real analysis) or others (simulated). <br />
                        <span style={{ fontSize: '0.875rem', color: 'var(--color-accent)' }}>Requires API Key in Settings</span>
                    </p>

                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem' }}>
                        <label className="btn btn-primary" style={{ cursor: analyzing ? 'wait' : 'pointer', opacity: analyzing ? 0.7 : 1 }}>
                            {analyzing ? <Loader2 className="animate-spin" /> : 'Select File to Scan'}
                            <input type="file" onChange={handleFileUpload} disabled={analyzing} style={{ display: 'none' }} accept=".txt,.pdf,.jpg" />
                        </label>

                        {error && (
                            <div style={{ color: '#EF4444', fontSize: '0.875rem', maxWidth: '400px' }}>
                                Error: {error}
                                {error.includes("Settings") && <Link href="/settings" style={{ textDecoration: 'underline', marginLeft: '0.5rem' }}>Go to Settings</Link>}
                            </div>
                        )}
                    </div>
                </div>
            )}

            {analysis && (
                <div className="space-y-6">
                    <div className="glass" style={{ padding: '1.5rem', borderRadius: 'var(--radius-lg)', border: '1px solid var(--color-success)', background: '#ECFDF5' }}>
                        <div style={{ display: 'flex', gap: '1rem' }}>
                            <CheckCircle className="text-success" />
                            <div>
                                <h3 style={{ fontWeight: 600, color: '#065F46' }}>Analysis Complete</h3>
                                <p style={{ fontSize: '0.875rem', color: '#047857' }}>AI has extracted the key terms from your document.</p>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}
import Link from 'next/link';
import { ArrowRight, Shield, FileText, Camera, Clock } from 'lucide-react';

export default function Home() {
    return (
        <div style={{ paddingBottom: '4rem' }}>
            {/* Hero Section */}
            <section style={{ padding: '8rem 0 6rem', textAlign: 'center' }}>
                <div className="container">
                    <div style={{ marginBottom: '1.5rem', display: 'inline-flex', alignItems: 'center', gap: '0.5rem', padding: '0.5rem 1rem', background: '#F3F4F6', borderRadius: '100px', fontSize: '0.875rem', fontWeight: 500 }}>
                        <Shield size={16} className="text-accent" />
                        <span>Privacy-first. EU-compliant.</span>
                    </div>
                    <h1 style={{ fontSize: '3.5rem', fontWeight: 800, lineHeight: 1.1, marginBottom: '1.5rem', letterSpacing: '-0.025em' }}>
                        Rental protection for <br />
                        <span style={{ color: 'var(--color-accent)' }}>expats and tenants.</span>
                    </h1>
                    <p style={{ fontSize: '1.25rem', color: 'var(--color-text-secondary)', maxWidth: '600px', margin: '0 auto 2.5rem' }}>
                        Turn contracts, photos, and deadlines into clear, professional evidence.
                        Avoid disputes before they start.
                    </p>
                    <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center' }}>
                        <Link href="/dashboard" className="btn btn-primary" style={{ height: '3rem', fontSize: '1rem' }}>
                            Create a Free Case
                        </Link>
                        <Link href="#how-it-works" className="btn btn-outline" style={{ height: '3rem', fontSize: '1rem' }}>
                            How it works
                        </Link>
                    </div>
                </div>
            </section>

            {/* Features Grid */}
            <section id="how-it-works" className="container" style={{ marginBottom: '6rem' }}>
                <div className="grid-cols-3">
                    <div className="card">
                        <div style={{ width: '3rem', height: '3rem', background: '#EFF6FF', color: 'var(--color-accent)', borderRadius: '0.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.25rem' }}>
                            <FileText size={24} />
                        </div>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '0.75rem' }}>Contract Quick Scan</h3>
                        <p style={{ color: 'var(--color-text-secondary)', lineHeight: 1.6 }}>
                            Upload your PDF. AI extracts key terms, deadlines, and deposit details—no legal jargon.
                        </p>
                    </div>

                    <div className="card">
                        <div style={{ width: '3rem', height: '3rem', background: '#ECFDF5', color: 'var(--color-success)', borderRadius: '0.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.25rem' }}>
                            <Camera size={24} />
                        </div>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '0.75rem' }}>Evidence Capture</h3>
                        <p style={{ color: 'var(--color-text-secondary)', lineHeight: 1.6 }}>
                            Structured room-by-room photo logging at check-in. Establish a baseline condition instantly.
                        </p>
                    </div>

                    <div className="card">
                        <div style={{ width: '3rem', height: '3rem', background: '#FFF7ED', color: '#F97316', borderRadius: '0.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.25rem' }}>
                            <Clock size={24} />
                        </div>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '0.75rem' }}>Deadline Tracking</h3>
                        <p style={{ color: 'var(--color-text-secondary)', lineHeight: 1.6 }}>
                            Never miss a notice period. We calculate critical dates based on your lease terms.
                        </p>
                    </div>
                </div>
            </section>

            {/* Pricing */}
            <section className="container" style={{ padding: '4rem 0', borderTop: '1px solid var(--color-border)' }}>
                <div style={{ textAlign: 'center', marginBottom: '4rem' }}>
                    <h2 style={{ fontSize: '2.5rem', fontWeight: 700, marginBottom: '1rem' }}>Pay only when it matters.</h2>
                    <p style={{ color: 'var(--color-text-secondary)' }}>No subscriptions. One-time payments per rental case.</p>
                </div>

                <div className="grid-cols-3">
                    <div className="card" style={{ padding: '2rem' }}>
                        <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Check-In Pack</h3>
                        <div style={{ fontSize: '2.5rem', fontWeight: 700, margin: '1rem 0' }}>€19</div>
                        <ul style={{ listStyle: 'none', color: 'var(--color-text-secondary)', marginBottom: '2rem', display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            <li>✓ Contract Quick Scan</li>
                            <li>✓ Check-in Evidence Report</li>
                            <li>✓ 18-month retention</li>
                        </ul>
                        <button className="btn btn-outline" style={{ width: '100%' }}>Select</button>
                    </div>

                    <div className="card" style={{ padding: '2rem', borderColor: 'var(--color-accent)', boxShadow: 'var(--shadow-md)', position: 'relative' }}>
                        <div style={{ position: 'absolute', top: '-12px', left: '50%', transform: 'translateX(-50%)', background: 'var(--color-accent)', color: 'white', padding: '0.25rem 0.75rem', borderRadius: '100px', fontSize: '0.75rem', fontWeight: 600 }}>BEST VALUE</div>
                        <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Full Bundle</h3>
                        <div style={{ fontSize: '2.5rem', fontWeight: 700, margin: '1rem 0' }}>€39</div>
                        <ul style={{ listStyle: 'none', color: 'var(--color-text-secondary)', marginBottom: '2rem', display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            <li>✓ <strong>Both Packs</strong> included</li>
                            <li>✓ Shared Workspace</li>
                            <li>✓ Deposit Recovery Pack</li>
                            <li>✓ Priority Support</li>
                        </ul>
                        <button className="btn btn-primary" style={{ width: '100%' }}>Get Complete Protection</button>
                    </div>

                    <div className="card" style={{ padding: '2rem' }}>
                        <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Move-Out Pack</h3>
                        <div style={{ fontSize: '2.5rem', fontWeight: 700, margin: '1rem 0' }}>€29</div>
                        <ul style={{ listStyle: 'none', color: 'var(--color-text-secondary)', marginBottom: '2rem', display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            <li>✓ Move-out Evidence Log</li>
                            <li>✓ Deadline Tracking</li>
                            <li>✓ Deposit Recovery PDF</li>
                            <li>✓ 18-month retention</li>
                        </ul>
                        <button className="btn btn-outline" style={{ width: '100%' }}>Select</button>
                    </div>
                </div>
            </section>
        </div>
    );
}
/** @type {import('next').NextConfig} */
const nextConfig = {
    output: 'export',
    images: {
        unoptimized: true, // Required for static export
    },
    typescript: {
        ignoreBuildErrors: true, // For smoother build in this environment
    },
    eslint: {
        ignoreDuringBuilds: true,
    }
};

export default nextConfig;
